---
import type { UrlData } from '../types/url'
import Button from './ui/Button.astro'
import ClipboardIcon from '../icons/ClipboardIcon.astro'

interface Props {
  originalUrl: UrlData['originalUrl']
  shortUrl: UrlData['shortUrl']
  createdDate?: UrlData['createdDate']
  index?: number
}

const { originalUrl, shortUrl, createdDate, index = 0 } = Astro.props
const copyButtonId = `copy-btn-${index}`
---

<li
  class="border-neon rounded-lg p-4 bg-gray-800/90"
  data-date={createdDate}
  role="listitem"
>
  <dl class="space-y-3">
    <div>
      <dt class="font-bold text-neon-yellow">Original URL:</dt>
      <dd class="mt-1">
        <a
          href={originalUrl}
          aria-label={`Open original URL: ${originalUrl} in new tab`}
          class="text-blue-400 hover:text-blue-300 hover:underline focus:underline focus:outline-none focus:ring-2 focus:ring-neon-yellow focus:ring-offset-2 focus:ring-offset-gray-800 rounded"
          target="_blank"
          rel="noopener noreferrer"
        >
          {originalUrl}
        </a>
      </dd>
    </div>

    <div class="flex items-center justify-between gap-4">
      <div class="flex-1">
        <dt class="font-bold text-neon-yellow">Shortened URL:</dt>
        <dd class="mt-1">
          <a
            href={shortUrl}
            aria-label={`Open shortened URL: ${shortUrl} in new tab`}
            class="text-blue-400 hover:text-blue-300 hover:underline focus:underline focus:outline-none focus:ring-2 focus:ring-neon-yellow focus:ring-offset-2 focus:ring-offset-gray-800 shortened-url rounded"
            target="_blank"
            rel="noopener noreferrer"
            data-url={shortUrl}
            data-index={index}
          >
            {shortUrl}
          </a>
        </dd>
      </div>
      <Button
        id={copyButtonId}
        type="button"
        class="btn px-4 py-2 text-sm transition-all duration-200 hover:scale-105"
        data-url={shortUrl}
        data-index={index}
        aria-label={`Copy shortened URL ${shortUrl} to clipboard`}
      >
        <ClipboardIcon />
      </Button>
    </div>

    <div>
      <dt class="font-bold text-neon-yellow">Created:</dt>
      <dd class="mt-1">
        <time
          class="text-blue-400"
          data-date={createdDate}
          datetime={createdDate}
        >
          {createdDate}
        </time>
      </dd>
    </div>
  </dl>
</li>

<script define:vars={{ copyButtonId, shortUrl }}>
  const copyButton = document.getElementById(copyButtonId)
  if (copyButton) {
    const svg = copyButton.querySelector('svg')
    const path = svg.querySelector('path')
    const originalD = path.getAttribute('d')
    const originalStroke = path.getAttribute('stroke')
    const checkD = 'M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z'
    const checkStroke = 'var(--neon-green)'

    copyButton.addEventListener('click', () => {
      navigator.clipboard
        .writeText(shortUrl)
        .then(() => {
          path.setAttribute('d', checkD)
          path.setAttribute('stroke', checkStroke)
          setTimeout(() => {
            path.setAttribute('d', originalD)
            path.setAttribute('stroke', originalStroke)
          }, 2000)
        })
        .catch(() => {
          alert('Failed to copy URL')
        })
    })
  }
</script>
