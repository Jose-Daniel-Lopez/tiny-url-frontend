---
import AppHeader from './AppHeader.astro'
import Button from './ui/Button.astro'
import Input from './ui/Input.astro'
import ErrorMessage from './ui/ErrorMessage.astro'
import Urls from './Urls.astro'
---

<div class="container mx-auto p-6 max-w-2xl">
  <AppHeader />

  <div class="border-neon rounded-lg p-6 mb-6">
    <form id="url-form" class="space-y-4">
      <Input
        type="url"
        id="original-url"
        name="originalUrl"
        label="Original URL"
        placeholder="https://tab-to-dev.click/tejon-tech/"
        required
      />

      <Input
        type="password"
        id="auth-token"
        name="authToken"
        label="Auth Token"
        placeholder="Enter your auth token"
        required
      />

      <Button type="submit" class="btn btn-outline btn-orange w-full">
        Shorten URL
      </Button>
    </form>
  </div>

  <Button id="copy-btn" class="btn btn-outline btn-orange"> Copy</Button>

  <ErrorMessage id="error" message="Error" />

  <Urls server:defer>
    <div slot="fallback" class="loading">
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </Urls>
</div>

<script>
  document.getElementById('copy-btn')?.addEventListener('click', () => {
    const shortenedUrl = document.getElementById('shortened-url')?.textContent
    console.log('Copy button pressed', shortenedUrl)

    if (shortenedUrl) {
      navigator.clipboard
        .writeText(shortenedUrl)
        .then(() => {
          alert('URL copied to clipboard!')
        })
        .catch(() => {
          alert('Failed to copy URL')
        })
    }
  })

  document.getElementById('url-form')?.addEventListener('submit', (e) => {
    e.preventDefault()
    console.log('Form submitted')

    const shortenedUrl = 'https://short.ly/abc123' // Simulated shortened URL

    const urlDiv = document.getElementById('shortened-url')
    if (urlDiv) {
      urlDiv.textContent = shortenedUrl
    }

    const resultDiv = document.getElementById('result')
    if (resultDiv) {
      resultDiv.classList.remove('hidden')
    }

    alert('URL shortened successfully!')
  })
</script>
